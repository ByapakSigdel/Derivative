# üöÄ Windows + Edge Quick Start Guide

## Complete setup guide for testing Arduino upload on Windows with Microsoft Edge

---

## üìã Prerequisites

- ‚úÖ Windows 10/11
- ‚úÖ Microsoft Edge 89+ (or Chrome 89+)
- ‚úÖ Node.js 18+ installed
- ‚úÖ (Optional) Arduino board or USB-Serial adapter

---

## üéØ Part 1: Project Setup (5 minutes)

### Step 1: Navigate to Project

```powershell
cd C:\Users\ASUS\OneDrive\Desktop\Derivative\Derivative
```

### Step 2: Install Dependencies

```powershell
npm install
```

If you see any errors, try:
```powershell
npm install --legacy-peer-deps
```

### Step 3: Start Development Server

```powershell
npm run dev
```

You should see:
```
‚ñ≤ Next.js 14.x.x
- Local:        http://localhost:3000
```

---

## üß™ Part 2: Test Serial Communication (NO Arduino Needed!)

### Step 1: Open Test Page

1. Open **Microsoft Edge**
2. Go to: `http://localhost:3000/test-serial`

### Step 2: Enable Web Serial (If Needed)

If you get "not supported" error:

1. Go to: `edge://flags/#enable-experimental-web-platform-features`
2. Set to **Enabled**
3. Click **Restart** button
4. Go back to test page

### Step 3: Run Basic Test

1. Click **"1Ô∏è‚É£ Check Web Serial API"**
2. You should see: ‚úÖ "Web Serial API is available!"

### Step 4: Test Port Selection (Without Arduino)

1. **Connect ANY USB device** (optional):
   - Arduino board
   - USB-Serial adapter (FTDI, CH340)
   - Even USB mouse will show in device list!

2. Click **"üöÄ Full Serial Test"**

3. **Browser will show dialog**: "localhost wants to connect to a serial port"
   - You'll see list of available COM ports
   - Even if no Arduino: you can select any port
   - Click a port and press **Connect**

4. **What happens:**
   ```
   ‚úÖ Step 1: API available
   ‚úÖ Step 2: Port selected (COM3)
   ‚úÖ Step 3: Port opened successfully
   ‚úÖ Step 4: Data written successfully [0x30, 0x20]
   ‚ö†Ô∏è  Step 5: No response (expected without Arduino)
   ‚úÖ Step 6: Port closed
   
   ‚úÖ Your serial communication is working! üéâ
   ```

5. **Press F12** to open Developer Console and see detailed logs

### What This Proves:

‚úÖ Web Serial API is working  
‚úÖ Browser can access COM ports  
‚úÖ Port can be opened  
‚úÖ **Data CAN be sent to the port** ‚Üê This is what you wanted to verify!  
‚ö†Ô∏è  No response (normal without Arduino)  

---

## üìä Part 3: Understanding Serial Ports on Windows

### Check Available COM Ports

1. Press **Windows Key + X**
2. Click **"Device Manager"**
3. Expand **"Ports (COM & LPT)"**

You'll see something like:
```
Ports (COM & LPT)
  ‚îú‚îÄ Arduino Uno (COM3)
  ‚îú‚îÄ USB Serial Port (COM4)
  ‚îî‚îÄ Communications Port (COM1)
```

### Without Arduino Connected:

- You might see COM1, COM2 (built-in serial ports)
- Or nothing at all (that's OK!)
- You can still test - just won't receive responses

### Creating Virtual COM Ports (Advanced):

If you want to test without any hardware:

1. Download **com0com**: https://sourceforge.net/projects/com0com/
2. Install (creates virtual COM port pairs)
3. Use these virtual ports for testing

---

## üíª Part 4: Using the Code Generator

### Example 1: Generate Simple Blink Code

Create a test file: `test-generator.ts`

```typescript
import { generateArduinoCode } from "./lib/arduino/codeGenerator";
import type { Graph } from "./types/graph";

// Simple LED blink graph
const blinkGraph: Graph = {
  nodes: [
    {
      id: "write-high",
      type: "DigitalWrite",
      payload: { pin: 13, value: true }
    },
    {
      id: "delay-1",
      type: "Delay",
      payload: { ms: 1000 }
    },
    {
      id: "write-low",
      type: "DigitalWrite",
      payload: { pin: 13, value: false }
    },
    {
      id: "delay-2",
      type: "Delay",
      payload: { ms: 1000 }
    }
  ],
  edges: [
    { from: "write-high", to: "delay-1" },
    { from: "delay-1", to: "write-low" },
    { from: "write-low", to: "delay-2" }
  ]
};

// Generate code
const code = generateArduinoCode(blinkGraph);
console.log(code);
```

**Output:**
```cpp
// Generated by Arduino Visual Scripting
// Date: 2025-12-23T...
// Nodes: 4, Edges: 3

void setup() {
  pinMode(13, OUTPUT);  // Configure pin 13
}

void loop() {
  digitalWrite(13, HIGH);  // write-high
  delay(1000);  // Wait 1000ms
  digitalWrite(13, LOW);  // write-low
  delay(1000);  // Wait 1000ms
}
```

### Example 2: Use in React Component

```tsx
"use client";
import { useState } from "react";
import { generateArduinoCode } from "@/lib/arduino/codeGenerator";
import type { Graph } from "@/types/graph";

export default function CodeGeneratorDemo() {
  const [code, setCode] = useState("");

  const generateBlink = () => {
    const graph: Graph = {
      nodes: [
        { id: "1", type: "DigitalWrite", payload: { pin: 13, value: true } },
        { id: "2", type: "Delay", payload: { ms: 1000 } },
        { id: "3", type: "DigitalWrite", payload: { pin: 13, value: false } },
        { id: "4", type: "Delay", payload: { ms: 1000 } }
      ],
      edges: [
        { from: "1", to: "2" },
        { from: "2", to: "3" },
        { from: "3", to: "4" }
      ]
    };

    const generatedCode = generateArduinoCode(graph);
    setCode(generatedCode);
  };

  return (
    <div>
      <button onClick={generateBlink}>Generate Blink Code</button>
      <pre>{code}</pre>
    </div>
  );
}
```

### Example 3: Analog Sensor Reading

```typescript
import { generateArduinoCode } from "./lib/arduino/codeGenerator";

const sensorGraph = {
  nodes: [
    {
      id: "read-sensor",
      type: "AnalogRead",
      payload: { pin: 0 }  // A0
    },
    {
      id: "wait",
      type: "Delay",
      payload: { ms: 100 }
    }
  ],
  edges: [
    { from: "read-sensor", to: "wait" }
  ]
};

const code = generateArduinoCode(sensorGraph);
```

**Output:**
```cpp
void setup() {
  Serial.begin(9600);  // Initialize serial communication
  pinMode(0, INPUT);  // Configure pin 0
}

void loop() {
  int read_sensor_val = analogRead(0);  // Read from A0
  delay(100);  // Wait 100ms
}
```

---

## üé® Part 5: Complete Upload Test Flow

### Full Integration Example

Create: `app/test-upload/page.tsx`

```tsx
"use client";
import { useState } from "react";
import { uploadArduinoSketch } from "@/lib/arduino/uploader";
import { generateArduinoCode } from "@/lib/arduino/codeGenerator";
import type { Graph } from "@/types/graph";

export default function TestUploadPage() {
  const [status, setStatus] = useState("Ready");
  const [progress, setProgress] = useState(0);

  const testUpload = async () => {
    // Step 1: Create simple graph
    const graph: Graph = {
      nodes: [
        { id: "1", type: "DigitalWrite", payload: { pin: 13, value: true } },
        { id: "2", type: "Delay", payload: { ms: 1000 } },
        { id: "3", type: "DigitalWrite", payload: { pin: 13, value: false } },
        { id: "4", type: "Delay", payload: { ms: 1000 } }
      ],
      edges: [
        { from: "1", to: "2" },
        { from: "2", to: "3" },
        { from: "3", to: "4" }
      ]
    };

    // Step 2: Generate Arduino code
    const code = generateArduinoCode(graph);
    console.log("Generated code:", code);

    // Step 3: Upload to Arduino
    const result = await uploadArduinoSketch(
      { code, board: "arduino:avr:uno" },
      (prog, msg) => {
        setProgress(prog);
        setStatus(msg);
      }
    );

    setStatus(result.ok ? "‚úÖ Success!" : `‚ùå ${result.message}`);
  };

  return (
    <div className="p-8">
      <h1 className="text-2xl font-bold mb-4">Test Full Upload Flow</h1>
      
      <button
        onClick={testUpload}
        className="bg-blue-600 text-white px-6 py-3 rounded"
      >
        Generate & Upload Test Code
      </button>
      
      <div className="mt-4">
        <div className="w-full bg-gray-200 rounded h-4">
          <div
            className="bg-blue-600 h-4 rounded"
            style={{ width: `${progress}%` }}
          />
        </div>
        <p className="mt-2">{status}</p>
      </div>
    </div>
  );
}
```

---

## üìö Part 6: All Imports You Need

### Import Cheat Sheet

```typescript
// Type definitions
import type { Graph, Node, Edge, NodeType } from "@/types/graph";
import type { BoardTarget, UploadRequest, UploadResult } from "@/types/arduino";

// Code generation
import { 
  generateArduinoCode, 
  generateExampleSketch,
  validateArduinoCode 
} from "@/lib/arduino/codeGenerator";

// Upload functions
import { 
  uploadArduinoSketch,
  isWebSerialSupported,
  requestSerialPort,
  detectBoards,
  testSerialConnection 
} from "@/lib/arduino/uploader";

// Testing utilities
import {
  testWebSerialAvailability,
  testSerialPortSelection,
  testSerialCommunication,
  listPreviousPorts,
  setupSerialMonitoring,
  type TestResult
} from "@/lib/arduino/serialTester";

// UI Components
import Button from "@/components/ui/Button";
import UploadPanel from "@/components/editor/UploadPanel";
```

---

## üéØ Testing Checklist

### ‚úÖ What You Can Test NOW (Without Arduino):

- [x] Web Serial API availability
- [x] Port selection dialog
- [x] Opening serial connection
- [x] **Sending data to COM port** ‚Üê You wanted this!
- [x] Code generation from nodes
- [x] Arduino code validation

### ‚è≥ What Needs Arduino:

- [ ] Receiving responses from Arduino
- [ ] Actual code execution on hardware
- [ ] LED blinking verification
- [ ] Sensor readings

---

## üêõ Troubleshooting

### Issue 1: "Web Serial API not supported"

**Solution:**
```
1. Check Edge version: edge://version/ (need 89+)
2. Enable flag: edge://flags/#enable-experimental-web-platform-features
3. Restart browser
```

### Issue 2: No COM ports visible

**Solution:**
```
1. Open Device Manager (Win+X ‚Üí Device Manager)
2. Check "Ports (COM & LPT)" section
3. If empty: connect USB device and check again
4. Refresh browser page
```

### Issue 3: Port selection dialog doesn't appear

**Solution:**
```
1. Must be user-initiated (click button)
2. Must be on localhost or HTTPS
3. Check browser console (F12) for errors
4. Try different USB port on computer
```

### Issue 4: "Access denied" error

**Solution:**
```
1. Close Arduino IDE if open (releases port)
2. Close other serial monitor programs
3. Disconnect and reconnect Arduino
4. Restart browser
```

---

## üìù Next Steps

### What You Have Now:

1. ‚úÖ Working serial port selection
2. ‚úÖ Ability to send data to COM ports
3. ‚úÖ Code generation from visual nodes
4. ‚úÖ Complete upload infrastructure

### To Complete Full Upload:

1. **Backend Setup** (for compilation):
   ```powershell
   # Install Arduino CLI
   choco install arduino-cli
   
   # Configure
   arduino-cli config init
   arduino-cli core install arduino:avr
   ```

2. **Test with Arduino**:
   - Connect Arduino
   - Run full upload test
   - Verify LED blinks

---

## üí° Pro Tips

1. **Browser Console is Your Friend**
   - Always have F12 open when testing
   - Check Network tab for API calls
   - Check Console for detailed logs

2. **Test Incrementally**
   - First: Check API availability
   - Then: Test port selection
   - Then: Test data sending
   - Finally: Full upload with Arduino

3. **USB Cable Matters**
   - Use data cable (not charge-only)
   - Try different USB ports
   - Some cables are flaky

4. **Virtual Ports for Development**
   - Use com0com for testing without hardware
   - Create port pairs (COM10 ‚Üî COM11)
   - Read from one, write to other

---

## üéì Learning Resources

- [Web Serial API Docs](https://developer.mozilla.org/en-US/docs/Web/API/Web_Serial_API)
- [Edge Feature Status](https://developer.microsoft.com/en-us/microsoft-edge/status/webserialapi/)
- [Arduino Language Reference](https://www.arduino.cc/reference/en/)

---

## ‚úÖ Success Criteria

You'll know it's working when:

1. Test page shows "‚úÖ Web Serial API is available!"
2. Clicking test button shows port selection dialog
3. Port opens successfully
4. Data written: `[0x30, 0x20]` appears in logs
5. Status shows "‚úÖ Your serial communication is working! üéâ"

**This proves your code CAN send data to serial ports!**

---

## üÜò Need Help?

1. Check browser console (F12)
2. Review this guide's troubleshooting section
3. Check `docs/ARDUINO_UPLOAD_GUIDE.md` for details
4. Test on Chrome if Edge has issues

---

**You're all set! Start testing at: http://localhost:3000/test-serial** üöÄ
